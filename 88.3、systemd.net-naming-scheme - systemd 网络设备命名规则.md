# systemd.net-naming-scheme

## 名称

systemd.net-naming_scheme - 网络设备命名方案

## 描述

网络界面名和 MAC 地址可以基于特定的稳定界面属性生成。当有足够的关于设备信息，就可以生成这些属性，且这些信息的使用已经被配置了。该也描述了界面命名，也即，可能会生成什么样的名称。这些名称通过 *systemd-udevd.service(8)* 的内建函数 **net_id** 生成，并导出为 udev 属性（**ID_NET_NAME_ONBOARD=**，**ID_NET_LABEL_ONBOARD=**，**ID_NET_NAME_PATH=**，**ID_NET_NAME_SLOT=**）。

名称和 MAC 地址来源于各种稳定的设备元属性。较新版本的 udev 会将更多这些属性考虑在内，提升了（也因此可能会改变）同一设备的名称和地址。不同版本的生成规则就被称为“命名方案”。默认命名方案在编译时就选定了。通常这将作为最新的实现了的版本，但也可以设置为较旧的版本来保证兼容性。命名方案可以通过内核命令 `net_naming-scheme=` 来切换，参见 *systemd-udevd.service(8)*。可用的命名方案在下方描述。

在 udev 属性已经生成之后，适当的 udev 规则将用于基于这些属性实际重命名设备。参见 *systemd.link(5)* 中的 `NamePolicy=` 和 `MACAddressPolicy=` 的描述。

## 命名

所有名字均以两字符的前缀来标明界面类型。

表 1. 基于界面类型的两字符前缀

| 前缀  |        描述        |
| :---: | :----------------: |
|  en   |       以太网       |
|  ib   |      无限带宽      |
|  sl   |  串行 IP（slip）   |
|  wl   | 无线局域网（WLAN） |
|  ww   | 无线广域网（WWAN） |

udev 内建函数 **net_id** 会导出下列 udev 设备属性：

- `ID_NET_NAME_ONBOARD=prefixonumber`

    该名称基于板载设备的固件给出的排序信息设置。该名称由前缀、字母 `o` 和一个固件决定的数字组成。仅对 PCI 设备有效。

- `ID_NET_LABEL_ONBOARD=prefix label`

    该属性基于板载设备的固件的标签而设置。名称由前缀和标签衔接而成。仅对 PCI 设备有效。

- `ID_NET_NAME_MAC=prefixxAABBCCDDEEFF`

    该名称由前缀、字母 `x` 和 MAC 地址的 12 个十六进制数组成。若设备具有固定的 MAC 地址，则该属性可用。由于该名称基于卡本身的属性，当设备移动时（甚至是在机器见移动时）该属性依旧保持“稳定”，但会因为硬件更换而改变。

- `ID_NET_NAME_SLOT=prefix[Pdomain]sslot[ffunction][nport_name|ddev_port]`
- `ID_NET_NAME_SLOT=prefix[Pdomain]sslot[ffunction][nport_name|ddev_port]bnumber`
- `ID_NET_NAME_SLOT=prefix[Pdomain]sslot[ffunction][nport_name|ddev_port]uport…[cconfig][iinterface]`
- `ID_NET_NAME_SLOT=prefix[Pdomain]sslot[ffunction][nport_name|ddev_port]vslot`

    这个属性描述了槽位置。基于不同的总线类型会有不同的描述方案，如下表格所述。无论如何，PCI 槽信息必须被知晓。在 USB BCMA 和 SR-VIO 设备的情况下，全名由前缀、PCI 槽标识符、以及 USB 或 BCMA 或 SR-VIO 槽标识符组成。头两部分在表中以 `…` 表示。

    表 2. 槽命名方案

    |                             格式                              |           描述           |
    | :-----------------------------------------------------------: | :----------------------: |
    | `prefix [Pdomain] sslot [ffunction] [nport_name | ddev_port]` |        PCI 槽编号        |
    |                          `… bnumber`                          | 博通总线（BCMA）核心编号 |
    |               `… uport… [cconfig] [iinterface]`               |       USB 端口号链       |
    |                           `… vslot`                           |      SR-VIO 槽编号       |

    仅当 PCI 域不为 0 时，才会作为前缀。所有多功能 PCI 设备将在名称中携带 **ffunction** 编号，包含功能 0 设备。对于非多功能设备，若为 0 则隐藏编号。将使用端口名 **port_name**，瑞哦不知道名称，则使用端口号 **ddev_port**。

    对于 BCMA 设备，当核心编号为 0 时隐藏。

    对于 USB 设备，将使用集线器的端口号的全链。若名称超过了 15 个字符，则名称就不会被导出。常用的 USB 配置号 1 和界面号 0 均会被隐藏。

- `ID_NET_NAME_PATH=prefixcbus_id`
- `ID_NET_NAME_PATH=prefixavendormodeliinstance`
- `ID_NET_NAME_PATH=prefixiaddressnport_name`
- `ID_NET_NAME_PATH=prefix[Pdomain]pbussslot[ffunction][nphys_port_name|ddev_port]`
- `ID_NET_NAME_PATH=prefix[Pdomain]pbussslot[ffunction][nphys_port_name|ddev_port]bnumber`
- `ID_NET_NAME_PATH=prefix[Pdomain]pbussslot[ffunction][nphys_port_name|ddev_port]uport…[cconfig][iinterface]`

    该属性描述了设备的安装地址。基于不同的总线类型会有不同的描述方案，如下表格所述。对于 BCMA 和 USB 设备，PCI 路径信息必须被知晓，全名包含前缀、PCI 槽标识符、以及 USB 或 BCMA 地址。头两部分在表中以 `…` 表示。

    表 3. 路径命名方案

    |                                  格式                                   |                  描述                   |
    | :---------------------------------------------------------------------: | :-------------------------------------: |
    |                            `prefix cbus_id`                             |       CCW 或组队的 CCW 设备标识符       |
    |                    `prefix avendor model iinstance`                     |      ARM64 平台设备的 ACPI 路径名       |
    |                      `prefix iaddress nport_name`                       | Netdevsim（模拟网络设备）设备名和端口名 |
    | `prefix [Pdomain] pbus sslot [ffunction] [nphys_port_name | ddev_port]` |              PCI 地理位置               |
    |                               `… bnumber`                               |         博通总线（BCMA）核心号          |
    |                    `… uport… [cconfig] [iinterface]`                    |             USB 端口编号链              |

    CCW 和组队 CCW 设备在 IBM System Z 主机中发现。任何前序的零和点号均被省略。

    对于 PCI、BCMA、以及 USB 设备，将使用与上述槽命名相同的规则。
