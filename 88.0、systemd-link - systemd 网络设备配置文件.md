# systemd.link

## 名称

systemd.link — 网络设备配置

## 概要

*link*`.link`

## 描述

网络链路配置由 **net_setup_link** udev 内建函数执行。

链路文件从位于系统网络文件夹 `/usr/lib/systemd/network`，易失运行时网络文件夹 `/run/systemd/network`，以及本地管理网络文件夹 `/etc/systemd/network` 中读取。链路文件必须具有后缀名 `.link`；其它后缀名皆被忽略。所有链路文件均以字符顺序排列和处理，无论他们所处的文件夹。但是，具有完全一致文件名的文件将相互替代。在 `/etc` 中的文件具有最高优先级，在 `/run` 中的文件优先于 `/usr/lib` 中的同名文件。这可以按需使用一个本地文件覆盖一个系统提供的链路文件。作为特例，一个空文件（文件大小为 0），或具有相同文件名，但指向 `/dev/null` 的文件完全禁用一个文件（被“遮盖”）。

链路文件包含一个 `[Match]` 段，它决定一个给定的链路文件可以作用于一个给定的设备，以及一个 `[Link]` 段指定设备该如何配置。首个（以字符顺序）匹配上给定设备的链路文件将起效。注意，默认文件 `99-default.link` 是附在系统中的。任何用户提供的 `.link` 应该具有比该文件更早的文件名，来让配置文件被考虑在内。

参见 *udevadm(8)* 来诊断 `.link` 文件的问题。

## `[Match]` 段选项

A link file is said to match a device if all matches specified by the "[Match]" section are satisfied. When a link file does not contain valid settings in "[Match]" section, then the file will match all devices and systemd-udevd warns about that. Hint: to avoid the warning and to make it clear that all interfaces shall be matched, add the following:

如果在 `[Match]` 段指定的所有条目均匹配了一个设备，则说该链路文件匹配上该设备。当一个链路文件不具有有效的 `[Match]` 段时，该文件将匹配所有的设备，且 **systemd-udevd** 将警告该情况。提示：要避免警告，并明确所有的界面均配匹配，添加如下内容：

```systemd.link
OriginalName=*
```

接受下列键：

- `MACAddress=`

    一个白空格分隔的列表，内容为硬件地址。使用全 分号、连字符、点号分隔的十六进制数。参见下方的例子。该选项可多次指定，在这种情况下，列表将会被合并。若在该选项中使用了空字符串，则重置前序所有指定的硬件地址。

    例子：

    ```systemd.link
    MACAddress=01:23:45:67:89:ab 00-11-22-33-44-55 AABB.CCDD.EEFF
    ```

- `OriginalName=`

    一个白空格分隔的列表，内容为 shell 样式通配符匹配的设备名称，该名称如 udev 属性 **INTERFACE** 中提供的一样。它不能被用于匹配已经从用户空间修改过的名称。当匹配内核分配的名称时要额外注意，这些名称在每次重启之后是不稳定的。

- `Path=`

    一个白空格分隔的列表，内容为 shell 样式通配符匹配的永久路径，如 udev 属性 **ID_PATH**。

- `Driver=`

    一个白空格分隔的列表，内容为 shell 样式通配符匹配的当前与设备所绑定的驱动，如同其父级设备的 udev 属性 **ID_NET_DRIVER**，如果该 udev 属性为设置，则为该设备自身通过 `ethtool -i` 获取的一样。

- `Type=`

    一个白空格分隔的列表，内容为 shell 样式通配符匹配的设备类型，如同 udev 属性 **DEVTYPE**。

- `Property=`

    一个白空格分隔的列表，内容为 udev 属性名以及一个等号 `=` 和该属性对应的值。若指定了多个属性，则测试结果取“且”。若列表前缀一个 `!`，则测试反向。若一个值包含白空格，则请用双引号包含整个键值对。若一个值包含引号，则使用 `\` 将引号转义。

    案例：若一个 `.link` 文件具有下列内容：

    ```systemd.link
    Property=ID_MODEL_ID=9999 "ID_VENDOR_FROM_DATABASE=vendor name" "KEY=with \"quotation\""
    ```

    则 `.link` 文件仅匹配与上述三个属性均匹配的界面。

- `Host=`

    匹配主机名或主机的机器名。参见 *systemd.unit(5)* 中的 `ConditionHost=` 了解详情。若前缀了一个 `!`，结果取反。若赋予了一个空字符串，则清除前序值。

- `Virtualization=`

    检查系统是否在虚拟环境中运行，并额外地测试该虚拟环境是否为特定的实现。参见 *systemd.unit(5)* 中的 `ConditionVirtualization=` 了解详情。若前缀了一个 `!`，则结果取反。若赋予了一个空字符串，则清除前序值。

- `KernelCommandLine=`

    测试是否设置了特定的内核命令。参见 *systemd.unit(5)* 中的 `ConditionKernelCommandLine=` 了解详情。若前缀了一个 `!`，则结果取反。若赋予了一个空字符串，则清除前序值。

- `KernelVersion=`

    测试内核版本（如 `uname -r` 回报的）匹配一个特定的表达式。参见 *systemd.unit(5)* 中的 `ConditioniKernelVersion=` 了解详情。若前缀了一个 `!`，则结果取反。若赋予了一个空字符串，则清除前序值。

- `Architecture=`

    测试系统是否在一个特定的架构上运行。参见 *systemd.unit(5)* 中的 `ConditionArchitecture=` 了解详情。若前缀了一个 `!`，则结果取反。若赋予了一个空字符串，则清除前序值。
