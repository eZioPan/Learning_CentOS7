名称

udev 动态设备管理



描述

udev 为系统软件提供了设备事件、设备节点权限控制、在 /dev 目录下创建额外的软链接、或者重命名网络界面的功能
内核一般仅通过发现顺序提供一系列不可读的设备名
有意义的软链接或网络设备名提供了一种可靠地通过设备属性和当前配置甄别设备的能力

当硬件发生 增加/移除/改变状态 时，udev 的守护进程—— systemd-udevd.service(8)，可以直接从内核中获取设备的 uevent
当 udev 获取一个设备事件，它会将设备属性和已经配置好的规则集进行匹配，来分辨出设备
被匹配上的规则会提供设备附加的信息，而这些信息将存放在 udev 的数据库中，或被用于创建有意义的软链接名

所有 udev 处理的设备的信息都存放在 udev 的数据库中，并会被发给可能的事件订阅者
可以通过 libudev 库，获取全部的存储数据库和事件源



规则文件

udev 规则将从以下几个目录中读取
系统级别规则目录 /usr/lib/udev/rules.d
动态的运行时目录 /run/udev/rules.d
本地管理员目录   /etc/udev/rules.d
所有规则文件都集中排序，并按照字符顺序处理，而无视它们存放的目录
但是具有相同文件名的文件将替换其他文件：
/etc 下的文件具有最高的优先级，其次是 /run 下的，最后是 /usr/lib 下的
这可用于覆盖系统提供的规则
一个 /etc 下的规则文件，若与 /usr/lib 下的规则文件同名，但指向 /dev/null 的话，会屏蔽 /usr/lib 下同名的规则文件
一个规则文件必须以 .rules 结尾，其他的扩展名将会被忽略

规则文件的每行至少含所有一对 键-值 对
除了空行和以 # 开头的行，它们将被省略
有两种键：匹配键和赋值键
如果有的内容都通过匹配键匹配上了值，则规则将被启用，且赋值键将赋予特殊的值

一个匹配规则可以用来重命名一个网络界面，添加指向设备节点的软链接，或者运行一个特殊的程序来作为事件处理的一部分

一个规则可以包含一系列 逗号分隔 的 键-值 对
每个键都有一个明确的操作，它受到被使用的操作符的控制
合法的操作符包括：

==
	等于比较

!=
	不等于比较

=
	将指定值赋予键，具有列表的键将会被重置，并仅含有这个被赋予的值

+=
	将指定值追加至键的值列表后

-=
	从键的值列表中删去指定值

:=
	确定键的最终值，并禁用后续的任何更改


下列键名可以用于匹配设备的属性
部分键不仅可用于匹配产生事件的设备，也可用于匹配在 sysfs 中出现其的父级设备的属性
如果在同一个规则中，出现了多条匹配父级设备的键，则所有的键必须被用于匹配唯一且相同的父级设备

ACTION
	匹配事件的名称

DEVPATH
	匹配设备事件的 devpath

KERNEL
	匹配事件设备的名称

NAME
	匹配网络界面的名称
	一旦前面的规则中出现了对 NAME 的赋值，则 NANE 匹配就可以被使用

SYMLINK
	匹配软链接名称指向的节点
	一旦前面的规则中出现了对 SYMLINK 的赋值，则 SYMLINK 匹配就可以被使用
	可能会有多个软链接，仅需一个呗匹配上

DRIVER
	匹配事件设备的驱动名
	若要为设备设置该键，则仅在设备被绑定驱动，产生事件时设置

ATTR{文件名}
	匹配事件设备的 sysfs 属性值
	属性值末尾的空白字符会被省略，除非匹配规则的值本身具有尾端空白字符

KERNELS
	向上搜索 devpath 来匹配 设备名

SUBSYSTEMS
	向上搜索 devpath 来匹配设备的 subsystem 名

DRIVERS
	向上搜索 devpath 来匹配设备的 驱动名

ATTRS{文件名}
	向上搜索 devpath 中匹配 sysfs 的属性值的设备
	若有多个 ATTRS 匹配条件，则所有的匹配条件必须被同一个设备满足
	属性值末尾的空白字符会被省略，除非匹配规则的值本身具有尾端空白字符

TAGS
	向上搜索 devpath 中匹配上 tag 的设备

ENV{值}
	匹配设备的属性值

TAG
	匹配设备的 tag

TEST{八进制模式掩码}
	测试文件存在与否
	八进制权限掩码可以被指定

PROGRAM
	执行一个程序来确定是否匹配
	若程序成功返回，则键的值为 true
	设备属性通过环境变量的方式传入待执行的程序
	程序的 StdOut 可以用于 RESULT 键中

	仅可用于短暂运行的前景任务
	细节参见 RUN

RESULT
	匹配最后一次 PROGRAM 调用返回的字符串
	这个键可以用于与 PROGRAM 同一条或其后任何一条规则之中


大部分字段支持 shell 的 glob 样式匹配和可选样式（“或”样式）
下列特殊字符同样被支持：

"*"
	匹配 0 个或多个字符

"?"
	匹配单一字符

"[]"
	匹配出现在方括号内的单一字符
	允许使用连字符 - 来指定连续的字符
	左方括号后紧随感叹号 ! 表示取反

"|"
	分离可选样式
