Linux 的文件属性里只记录了 UID(user id) 和 GID(group id)
系统通过查询 /etc/passwd 将 UID 和 GID 对应的 用户名 与 群组名 显示出来

id [-gGu] [userName]/[UID]
-g, --group  仅显示 user name 所在的 effective group ID
-G, --groups 显示user name 所在的所有的 group ID
-u, --user   仅显示 effective user ID



/etc/passwd 和 /etc/shadow 的详细信息可以通过 man 5 passwd 和 man 5 shadow 获取


/etc/passwd 的文件结构

eg.

[passwd 文件第一行 root 相关信息]

root:x:0:0:root:/root:/bin/bash

第 1 栏：账号名称

第 2 栏：原密码位，现已保存至 /etc/shadow 中，此位使用 x 占位

第 3 栏：UID

UID 的分配
0				系统管理员 UID （也即 root 级别）
1 ~ 999			系统内部使用的 UID
* 1 ~ 200		系统发布者自行使用的 UID
* 201 ~ 999		使用者需要系统账号时可使用的 UID
1000 ~ 60000	一般使用者的 UID ， Linux Kernel 3.10.x 中 UID 最多可以开启 2^32-1 个

第 4 栏：initial GID（账户登录时即获得该群组权限）

第 5 栏：账户说明

第 6 栏：账户主目录路径

第 7 栏：账户使用的 Shell

若想让某个账户不可以登录 shell ，可以修改这栏为 /sbin/nologin



/etc/shadow 的文件结构

eg.

[shadow 文件第一行 root 相关信息]

root:<BlahBlahBlah>::0:99999:7:::


第 1 栏：账号名称

第 2 栏：经过加密的密码，CentOS7 常用的加密手段是 SHA

查询加密手段： authconfig --test | grep "hashing"

第 3 栏：最近一次密码修改的日期距离 1970 年 1 月 1 日 的天数

第 4 栏：密码在最近一次更改之后，在多少天之内不可再次更改密码

第 5 栏：密码在最近一次更改之后，在多少天之后必须重新设定密码

若不重新设定，则账号密码将会 变为过期特性
此时用户可以登录并取得 shell ，但登录后必须立刻修改密码才能继续使用

第 6 栏：密码在需要变更的几天前，系统会开始提醒用户变更密码

第 7 栏：在超过密码过期日几天之后，仍未做修改，此账号将变为无法登陆的状态

第 8 栏：账号在距离 1970 年 1 月 1 日 多少天后，将彻底失效，无法使用

第 9 栏：目前留用



/etc/group 的文件结构
root:x:0:
[group 文件第一行 root 相关信息]



第 1 栏：群组名称

第 2 栏：群组密码（很少使用），使用 x 占位

真实密码加密存储在 /etc/gshadow 文件中

第 3 栏：GID

第 4 栏：可加入这个群组的账户名

书写方法：冒号后紧跟账户名，账户名和账户名之间仅用逗号 , 隔开，不加空格
eg. root@x:0:eP,ep


注意，一个群组中可以包含多个账户，一个账户也可以加入多个群组



有效群组（effective group）和初始群组（initial group）

/etc/passwd 的第四栏中的 GID 对应的就是初始群组，也即使用者登录系统就获取的群组


查看用户所在群组

groups [<UserName>]
返回值的第一个即为当前的有效群组
若不输入用户名，则返回当前用户所在的群组


有效群组即为当前用户在当下真实生效的群组

有效群组的切换/登录到一个新群组

newgrp [-] [<GroupName>]
- 重新创建新的环境变量，不指定的话就沿用当前的环境变量

这个命令的本质是创建一个新的 shell ，在这个 shell 中，用户具有指定的 group
能够切换的群组必须是用户已经加入群组



/etc/gshadow 的文件结构

[gshadow 文件第一行 root 相关信息]

root:::

第 1 栏：群组名称

第 2 栏：群组管理员密码，若为 ! 或为空时，则无群组管理员

第 3 栏：群组管理员账号

第 4 栏：群组包含的账户，与 /etc/group 中指定的相同



账户管理的相关命令

用户的新增

useradd [-u <UID>] [-g <初始群组>] [-G <其他群组>] [-m|M] [-c <说明>] [-d <主目录绝对路径>] [-s <使用的 shell>] <新账户名>
注意！在使用 useradd 添加用户之后，用户默认是被封锁的，因为还没有设定账户密码
-u, --uid<UID> 用户指定一个 UID
-g, --gid<GID或GroupName> 用户指定的初始群组，这里可以使用 GID 或 群组名
-G, --groups<Group1>[,<Group2>...] 指定用户需要加入的其他群组，可以使用 GID 或 群组名，多个群组之间用逗号隔开
-m, --create-home 为新用户创建目录（一般账号的默认动作）
-M 不为新用户创建目录（系统账号的默认动作）
-c, --comment<Comment> 用户的简短描述，目前标示为完整用户名
-d, --home<主目录绝对路径> 设置主目录的绝对路径
-s, --shell<SHELL> 设置该账户将启动的 shell 程序
-r 创建系统账户
-e, --expiredate<YYYY-MM-DD> 指定账户的过期日期
-f, --inactive<密码过期时间> 指定账户的密码过期天数，0 为立刻失效，-1 为永不失效
